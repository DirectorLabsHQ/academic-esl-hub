<script>
const scores = [
    { 
        cefr: "C2", ielts: 8.5, toefl: 110, toeic: 945, opic: "AL", 
        desc: "English Master",
        canDo: "You can understand almost everything you hear or read perfectly. You can explain complex ideas clearly and talk like a native speaker.",
        tips: ["Read very difficult research papers.", "Focus on understanding cultural jokes and idioms.", "Practice giving professional speeches without a script."]
    },
    { 
        cefr: "C1", ielts: 7.5, toefl: 95, toeic: 850, opic: "IH", 
        desc: "Advanced User",
        canDo: "You can read long, difficult articles and understand the 'hidden' meaning. You can speak naturally without stopping to think about words.",
        tips: ["Read magazines like 'The Economist' to learn business words.", "Practice using advanced connecting words (like 'furthermore' or 'nonetheless').", "Record yourself speaking to find and fix small mistakes."]
    },
    { 
        cefr: "B2", ielts: 6.0, toefl: 72, toeic: 785, opic: "IM3", 
        desc: "Upper-Intermediate",
        canDo: "You can understand the main ideas of difficult books and talk about complicated topics in your own field (like your major or job).",
        tips: ["Try to summarize a news story in just one sentence.", "Learn more 'Academic' words (words used in textbooks).", "Watch movies or documentaries without subtitles."]
    },
    { 
        cefr: "B1", ielts: 4.5, toefl: 42, toeic: 550, opic: "IM2", 
        desc: "Intermediate Learner",
        canDo: "You can travel to an English-speaking country and talk to people easily. You can write simple emails and stories about things you know.",
        tips: ["Practice making longer sentences using 'and', 'but', and 'because'.", "Listen to English podcasts every day while you travel or exercise.", "Read 'Graded Readers' (books written for your level)."]
    },
    { 
        cefr: "A2+", ielts: 4.0, toefl: 32, toeic: 400, opic: "IM1", 
        desc: "High Beginner",
        canDo: "You can talk about your daily life and basic needs. You can have short conversations if the other person speaks slowly.",
        tips: ["Learn the 2,000 most common words in English.", "Make sure you really know your basic tenses (Past, Present, Future).", "Read out loud for 5 minutes every day to help your pronunciation."]
    },
    { 
        cefr: "A2", ielts: 3.0, toefl: 0, toeic: 225, opic: "IL", 
        desc: "Beginner",
        canDo: "You can understand basic sentences and talk about your family, your job, and your home.",
        tips: ["Use flashcards (like Anki) to learn new words every day.", "Practice making simple 'Subject + Verb + Object' sentences.", "Watch children's shows in English to hear simple grammar."]
    }
];

function convert(source, val) {
    if (!val || val === "") { resetDisplay(); return; }
    let match;
    const numVal = parseFloat(val);
    
    if (source === 'opic') {
        match = scores.find(s => s.opic === val) || scores[scores.length-1];
    } else {
        match = scores.find(s => numVal >= s[source]);
        if (!match) match = scores[scores.length - 1];
    }
    updateUI(match, source);
}

function updateUI(data, source) {
    if (source !== 'ielts') document.getElementById('ielts').value = data.ielts;
    if (source !== 'toefl') document.getElementById('toefl').value = data.toefl;
    if (source !== 'toeic') document.getElementById('toeic').value = data.toefl;
    if (source !== 'opic') document.getElementById('opic').value = data.opic;

    document.getElementById('cefr-display').innerText = data.cefr;
    document.getElementById('cefr-desc').innerText = data.desc;
    document.getElementById('cefr-can-do').innerText = data.canDo;
    
    const tipsList = document.getElementById('cefr-tips');
    tipsList.innerHTML = data.tips.map(tip => `<li>${tip}</li>`).join('');

    // Add uTalk affiliate recommendation for B1–C1 levels
    if (['B1', 'B2', 'C1'].includes(data.cefr)) {
        const utalkLi = document.createElement('li');
        utalkLi.innerHTML = `
            Build practical vocabulary quickly with real native-speaker audio lessons and game-based practice. 
            <a href="https://tidd.ly/3MaWhkg" 
               target="_blank" rel="noopener noreferrer nofollow" 
               class="text-blue-400 hover:text-blue-300 underline">
               Try uTalk (150+ languages, great for everyday phrases)
            </a> 
            — ideal alongside your academic English prep. (Affiliate link — we may earn a commission at no extra cost to you.)
        `;
        tipsList.appendChild(utalkLi);
    }
    
    document.getElementById('result-content').classList.remove('hidden');
    document.getElementById('placeholder-content').classList.add('hidden');
}

function resetDisplay() {
    document.getElementById('cefr-display').innerText = "—";
    document.getElementById('result-content').classList.add('hidden');
    document.getElementById('placeholder-content').classList.remove('hidden');
}
</script>
