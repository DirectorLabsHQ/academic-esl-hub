<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WPM Fluency Lab | Academic ESL Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #050505; color: #e5e5e5; font-family: 'Inter', sans-serif; }
        .card-bg { background: #111; border: 1px solid #222; }
        .hidden { display: none; }
        .accent-blue { color: #3b82f6; }
        .btn-primary { background: #3b82f6; transition: all 0.3s; }
        .btn-primary:hover { background: #2563eb; transform: translateY(-2px); }
    </style>
</head>
<body class="min-h-screen flex flex-col antialiased">

<header class="p-6 border-b border-white/5 bg-black/50 backdrop-blur-xl sticky top-0 z-50">
    <div class="max-w-6xl mx-auto flex justify-between items-center">
        <h1 class="text-xl font-black tracking-tighter text-blue-500 italic uppercase">ACADEMIC<span class="text-white">ESL</span>HUB</h1>
        <span class="text-[9px] font-bold text-neutral-500 tracking-[0.3em] uppercase">Fluency Diagnostic v1.0</span>
    </div>
</header>

<main class="flex-grow max-w-4xl mx-auto p-6 md:p-12 w-full">
    <div id="setup-area" class="text-center mb-12">
        <h2 class="text-5xl font-black text-white tracking-tighter mb-4 uppercase italic">WPM Fluency Lab</h2>
        <p class="text-neutral-400 text-sm max-w-xl mx-auto mb-8 leading-relaxed text-center">
            Measure your <span class="text-blue-500 font-bold">Effective Processing Speed</span>. Read the passage at your normal pace. You will be asked 3 comprehension questions afterward.
        </p>
        <button onclick="startTest()" class="btn-primary text-white px-10 py-4 rounded-full font-black uppercase italic tracking-widest text-sm">Start Random Test</button>
    </div>

    <div id="reading-area" class="hidden">
        <div class="flex justify-between items-center mb-6">
            <span class="text-[10px] font-black text-blue-500 uppercase tracking-widest">Reading in progress...</span>
            <div id="timer-display" class="font-mono text-xl text-white">00:00</div>
        </div>
        <div id="text-container" class="card-bg p-8 md:p-12 rounded-[2.5rem] text-xl md:text-2xl leading-relaxed text-neutral-300 serif italic mb-8 select-none">
            </div>
        <button onclick="endReading()" class="w-full bg-white text-black py-4 rounded-2xl font-black uppercase hover:bg-blue-500 hover:text-white transition-all">I have finished reading</button>
    </div>

    <div id="quiz-area" class="hidden">
        <h3 class="text-2xl font-bold text-white mb-6 uppercase italic">Comprehension Check</h3>
        <div id="questions-container" class="space-y-6 mb-8">
            </div>
        <button onclick="calculateResults()" class="btn-primary w-full py-4 rounded-2xl font-black uppercase text-white">Calculate Fluency</button>
    </div>

    <div id="result-area" class="hidden">
        <div class="card-bg p-10 rounded-[2.5rem] border-l-8 border-l-blue-600">
            <div class="grid md:grid-cols-3 gap-8 text-center md:text-left mb-8">
                <div>
                    <p class="text-[10px] font-black text-neutral-500 uppercase tracking-widest mb-1">Raw WPM</p>
                    <div id="raw-wpm" class="text-5xl font-black text-white">--</div>
                </div>
                <div>
                    <p class="text-[10px] font-black text-neutral-500 uppercase tracking-widest mb-1">Accuracy</p>
                    <div id="accuracy-pct" class="text-5xl font-black text-white">--</div>
                </div>
                <div>
                    <p class="text-[10px] font-black text-blue-500 uppercase tracking-widest mb-1 italic">Effective WPM</p>
                    <div id="effective-wpm" class="text-5xl font-black text-blue-500 underline">--</div>
                </div>
            </div>
            <div class="pt-8 border-t border-white/5">
                <h4 id="tier-label" class="text-white font-bold mb-2 uppercase text-xs tracking-widest">Assessment Profile</h4>
                <p id="tier-desc" class="text-neutral-500 text-sm leading-relaxed italic">--</p>
            </div>
        </div>
        <button onclick="location.reload()" class="mt-8 text-neutral-500 text-xs font-bold uppercase tracking-widest hover:text-white transition-all underline">Try another passage</button>
    </div>

</main>

<script>
    const passages = [
        {
            text: "Hi, my name is Ji-hyun. This is my third semester in university. I live off campus in a small studio apartment. Last year, I lived on campus in the dormitory. I have a part-time job as a clerk in a convenience store near campus. I had a roommate last year, but now I live alone. My friend Katarina is a new student here and her major is economics. We like to meet for lunch in the cafeteria. The food there is cheap and delicious.",
            questions: [
                { q: "Where does Ji-hyun live now?", a: ["Dormitory", "Studio apartment", "At home"], correct: 1 },
                { q: "What is her part-time job?", a: ["Cafeteria worker", "Clerk", "Economics tutor"], correct: 1 },
                { q: "Why did she move?", a: ["To live alone", "To be closer to work", "Not mentioned"], correct: 2 }
            ]
        },
        {
            text: "Welcome to our English club. This week we have two new members. Maria is from Brazil and Boris is from Russia. They both live in the dormitory, but Boris wants to move off campus next semester because his roommate snores too much. Maria is a fashion design major in her second year. Boris is studying mechanical engineering. We are going to meet in the cafÃ© downstairs after the club meeting to get a drink.",
            questions: [
                { q: "Where is Maria from?", a: ["Russia", "Brazil", "Korea"], correct: 1 },
                { q: "What is Boris's major?", a: ["Fashion design", "English", "Mechanical engineering"], correct: 2 },
                { q: "Why does Boris want to move?", a: ["He wants a studio", "His roommate snores", "It's too expensive"], correct: 1 }
            ]
        }
        // Add 8 more here following same structure...
    ];

    let currentPassage;
    let startTime;
    let timerInterval;

    function startTest() {
        currentPassage = passages[Math.floor(Math.random() * passages.length)];
        document.getElementById('setup-area').classList.add('hidden');
        document.getElementById('reading-area').classList.remove('hidden');
        document.getElementById('text-container').innerText = currentPassage.text;
        
        startTime = Date.now();
        timerInterval = setInterval(updateTimer, 1000);
    }

    function updateTimer() {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const m = Math.floor(elapsed / 60).toString().padStart(2, '0');
        const s = (elapsed % 60).toString().padStart(2, '0');
        document.getElementById('timer-display').innerText = `${m}:${s}`;
    }

    function endReading() {
        clearInterval(timerInterval);
        const timeInSeconds = (Date.now() - startTime) / 1000;
        window.readingTime = timeInSeconds;
        
        document.getElementById('reading-area').classList.add('hidden');
        document.getElementById('quiz-area').classList.remove('hidden');
        
        const container = document.getElementById('questions-container');
        container.innerHTML = currentPassage.questions.map((q, i) => `
            <div class="card-bg p-6 rounded-2xl">
                <p class="text-white font-bold mb-4">${q.q}</p>
                <div class="flex flex-col gap-2">
                    ${q.a.map((opt, oi) => `
                        <label class="flex items-center gap-3 p-3 rounded-xl hover:bg-white/5 cursor-pointer">
                            <input type="radio" name="q${i}" value="${oi}" class="accent-blue">
                            <span class="text-sm text-neutral-400">${opt}</span>
                        </label>
                    `).join('')}
                </div>
            </div>
        `).join('');
    }

    function calculateResults() {
        let correct = 0;
        currentPassage.questions.forEach((q, i) => {
            const selected = document.querySelector(`input[name="q${i}"]:checked`);
            if (selected && parseInt(selected.value) === q.correct) correct++;
        });

        const words = currentPassage.text.split(' ').length;
        const rawWpm = Math.round((words / window.readingTime) * 60);
        const accuracy = (correct / currentPassage.questions.length);
        const effectiveWpm = Math.round(rawWpm * accuracy);

        document.getElementById('quiz-area').classList.add('hidden');
        document.getElementById('result-area').classList.remove('hidden');
        
        document.getElementById('raw-wpm').innerText = rawWpm;
        document.getElementById('accuracy-pct').innerText = Math.round(accuracy * 100) + "%";
        document.getElementById('effective-wpm').innerText = effectiveWpm;

        let tier, desc;
        if (effectiveWpm < 80) {
            tier = "Developing Fluency";
            desc = "Your processing speed suggests you are still translating individual words. Focus on core vocabulary to increase automaticity.";
        } else if (effectiveWpm < 120) {
            tier = "Functional Fluency";
            desc = "You can handle daily communication well. To reach academic levels, practice 'Serial Reading' to increase stamina.";
        } else {
            tier = "Academic Ready";
            desc = "Excellent processing speed. You are ready for high-level university lectures and complex structural discussions.";
        }
        
        document.getElementById('tier-label').innerText = tier;
        document.getElementById('tier-desc').innerText = desc;
    }
</script>
</body>
</html>
